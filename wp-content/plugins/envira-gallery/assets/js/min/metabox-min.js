jQuery(document).ready(function(e){e('select[name="_envira_gallery[image_size]"]').on("change",function(){"envira_gallery_random"===e(this).val()?e("tr#envira-config-image-sizes-random-box").show():e("tr#envira-config-image-sizes-random-box").hide()}),e('select[name="_envira_gallery[image_size]"]').trigger("change"),e("#envira-gallery.postbox").on("dragstart",function(e){return!1})}),function(e){e(function(){var a=!1;"default"===e('input[name="_envira_gallery[type]"]:checked').val()?e("#envira-gallery-preview").hide():e("#envira-gallery-preview").show(),e(document).on("enviraGalleryType enviraGalleryPreview",function(){var t=e('input[name="_envira_gallery[type]"]:checked').val(),i=e("#envira-gallery-preview .spinner"),n=e("#envira-gallery-preview-main");"default"!==t?a||(a=!0,e(n).html(""),e.ajax({type:"post",url:envira_gallery_metabox.ajax,dataType:"json",data:{action:"envira_gallery_change_preview",post_id:envira_gallery_metabox.id,type:t,data:e("form#post").serializeArray(),nonce:envira_gallery_metabox.preview_nonce},success:function(t){e(n).html(t),e(i).hide(),a=!1},error:function(t,r){e(n).html('<div class="error"><p>'+t.responseText+"</p></div>"),e(i).hide(),a=!1}})):e(n).hide()})})}(jQuery),function(e){e(function(){e("#envira-gallery-types-nav").on("click","li",function(a){e('input[name="_envira_gallery[type]"]',e(this)).prop("checked",!0).trigger("change")}),e(document).on("change",'input[name="_envira_gallery[type]"]:radio',function(a){var t=e(this).val(),i=e("#envira-tabs #envira-tab-images .spinner"),n=e("#envira-tabs #envira-tab-images #envira-gallery-main");e(i).css("visibility","visible"),e("li",e(this).closest("#envira-gallery-types-nav")).removeClass("envira-active"),e(this).closest("li").addClass("envira-active"),e("a",e("#envira-tabs-nav li").first()).trigger("click"),e(n).html(""),e.ajax({type:"post",url:envira_gallery_metabox.ajax,dataType:"json",data:{action:"envira_gallery_change_type",post_id:envira_gallery_metabox.id,type:t,nonce:envira_gallery_metabox.change_nonce},success:function(a){e(n).html(a.html),e(document).trigger("enviraGalleryType",a),e(i).hide()},error:function(a,t){e(n).html('<div class="error"><p>'+a.responseText+"</p></div>"),e(i).hide()}})})})}(jQuery);var envira_video_link="p.envira-intro a.envira-video",envira_close_video_link="a.envira-video-close";jQuery(document).ready(function(e){e(document).on("click",envira_video_link,function(a){a.preventDefault();var t=e(this).attr("href");e("div.envira-video-help").remove();var i=e(this).closest("p.envira-intro");e(i).append('<div class="envira-video-help"><iframe src="'+t+'" /><a href="#" class="envira-video-close dashicons dashicons-no"></a></div>')}),e(document).on("click",envira_close_video_link,function(a){a.preventDefault(),e(this).closest(".envira-video-help").remove()})});var EnviraGalleryBulkEditImageView=wp.Backbone.View.extend({tagName:"li",className:"attachment",template:wp.template("envira-meta-bulk-editor-image"),initialize:function(e){this.model=e.model},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),EnviraGalleryBulkEditView=wp.Backbone.View.extend({tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("envira-meta-bulk-editor"),events:{"keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","blur textarea":"updateItem","change select":"updateItem","click .actions a.envira-gallery-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){this.on("loading",this.loading,this),this.on("loaded",this.loaded,this),this.is_loading=!1,this.collection=e.collection,this.child_views=e.child_views,this.model=new EnviraGalleryImage},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.collection.forEach(function(e){var a=new EnviraGalleryBulkEditImageView({model:e});this.$el.find("ul.attachments").append(a.render().el)},this),this.child_views.length>0&&this.child_views.forEach(function(e){var a=new e({model:this.model});this.$el.find("div.envira-addons").append(a.render().el)},this),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),this.model.set("status","active"),wpLink.init,this},renderError:function(e){var a={};return a.error=e,new wp.media.view.EnviraGalleryError({model:a}).render().el},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),void 0!==e&&this.$el.find("ul.attachments").before(this.renderError(e))},updateItem:function(e){""!==e.target.name&&("checkbox"===e.target.type?value=e.target.checked?1:0:value=e.target.value,this.model.set(e.target.name,value))},saveItem:function(e){e.preventDefault(),this.trigger("loading");var a=[];this.collection.forEach(function(e){a.push(e.id)},this),wp.media.ajax("envira_gallery_save_bulk_meta",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,post_id:envira_gallery_metabox.id,meta:this.model.attributes,image_ids:a},success:function(e){this.collection.forEach(function(a){for(var t in this.model.attributes)value=this.model.attributes[t],value.length>0&&("tags"==t?a.set(t,e[a.get("id")]):a.set(t,value));var i=JSON.stringify(a.attributes),n=jQuery("ul#envira-gallery-output li#"+a.get("id")+" .envira-item-status"),r=(n.data("status"),n.hasClass("list-status"),n.parent()),l=r.find(".envira-item-status.list-status"),s=r.find(".envira-item-status.grid-status"),o=(n.data("id"),s.find("span.dashicons")),d=l.find("span"),c=a.get("status");jQuery("ul#envira-gallery-output li#"+a.get("id")).attr("data-envira-gallery-image-model",i),jQuery("ul#envira-gallery-output li#"+a.get("id")+" div.title").text(a.get("title")),"active"===c?(s.removeClass("envira-draft-item").addClass("envira-active-item"),l.removeClass("envira-draft-item").addClass("envira-active-item"),o.removeClass("dashicons-hidden").addClass("dashicons-visibility"),d.text(envira_gallery_metabox.active),s.attr("data-envira-tooltip",envira_gallery_metabox.active),l.data("status","active"),s.data("status","active")):(s.removeClass("envira-active-item").addClass("envira-draft-item"),l.removeClass("envira-active-item").addClass("envira-draft-item"),o.removeClass("dashicons-visibility").addClass("dashicons-hidden"),d.text(envira_gallery_metabox.draft),l.data("status","pending"),s.data("status","pending"),s.attr("data-envira-tooltip",envira_gallery_metabox.draft))},this),jQuery("nav.envira-tab-options input[type=checkbox]").prop("checked",!1).trigger("change"),this.trigger("loaded loaded:success"),EnviraGalleryModalWindow.close()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertMediaFileLink:function(e){this.trigger("loading"),this.model.set("link",response.media_link),this.trigger("loaded loaded:success"),this.render()},insertAttachmentPageLink:function(e){this.trigger("loading"),this.model.set("link",response.media_link),this.trigger("loaded loaded:success"),this.render()}});jQuery(document).ready(function(e){e("#envira-gallery-main").on("click","a.envira-gallery-images-edit",function(e){e.preventDefault(),EnviraGalleryImagesUpdate(!0),EnviraGalleryModalWindow.content(new EnviraGalleryBulkEditView({collection:EnviraGalleryImages,child_views:EnviraGalleryChildViews})),EnviraGalleryModalWindow.open()})});var EnviraGalleryImage=Backbone.Model.extend({defaults:{id:"",title:"",caption:"",alt:"",link:""}}),EnviraGalleryImages=new Backbone.Collection;if(void 0===EnviraGalleryModalWindow)var EnviraGalleryModalWindow=new wp.media.view.Modal({controller:{trigger:function(){}}});var EnviraGalleryEditView=wp.Backbone.View.extend({tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("envira-meta-editor"),events:{"click .edit-media-header .left":"loadPreviousItem","click .edit-media-header .right":"loadNextItem","keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","blur textarea":"updateItem","change select":"updateItem","click .actions a.envira-gallery-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){this.on("loading",this.loading,this),this.on("loaded",this.loaded,this),this.is_loading=!1,this.collection=e.collection,this.child_views=e.child_views,this.attachment_id=e.attachment_id,this.attachment_index=0,this.search_timer="";var a=0;this.collection.each(function(e){if(e.get("id")==this.attachment_id)return this.model=e,this.attachment_index=a,!1;a++},this)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.child_views.length>0&&this.child_views.forEach(function(e){var a=new e({model:this.model});this.$el.find("div.envira-addons").append(a.render().el)},this),this.$el.find("textarea[name=caption]").val(this.model.get("caption")),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),wpLink.init,0==this.attachment_index&&this.$el.find("button.left").addClass("disabled"),this.attachment_index==this.collection.length-1&&this.$el.find("button.right").addClass("disabled"),jQuery(document).trigger("enviraRenderMeta"),this},renderError:function(e){var a={};return a.error=e,new wp.media.view.EnviraGalleryError({model:a}).render().el},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),void 0!==e&&this.$el.find("div.media-toolbar").after(this.renderError(e))},loadPreviousItem:function(e){this.saveItem(e),this.updateItem(e),this.attachment_index--,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},loadNextItem:function(e){this.saveItem(e),this.updateItem(e),this.attachment_index++,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},updateItem:function(e){""!=e.target.name&&("checkbox"==e.target.type?value=e.target.checked?e.target.value:0:value=e.target.value,this.model.set(e.target.name,value))},saveItem:function(e){e.preventDefault(),this.trigger("loading"),wp.media.ajax("envira_gallery_save_meta",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,post_id:envira_gallery_metabox.id,attach_id:this.model.get("id"),meta:this.model.attributes},success:function(e){this.trigger("loaded loaded:success");var a=JSON.stringify(this.model.attributes),t=jQuery("ul#envira-gallery-output li#"+this.model.get("id"));jQuery(t).attr("data-envira-gallery-image-model",a),jQuery("div.meta div.title span",t).text(this.model.get("title")),jQuery("div.meta div.title a.hint",t).attr("title",this.model.get("title")),this.model.get("title").length>20?jQuery("div.meta div.title a.hint",t).removeClass("hidden"):jQuery("div.meta div.title a.hint",t).addClass("hidden");var i=this.$el.find(".saved");i.fadeIn(),setTimeout(function(){i.fadeOut()},1500)},error:function(e){this.trigger("loaded loaded:error",e)}})},searchLinks:function(e){},insertLink:function(e){},insertMediaFileLink:function(e){this.trigger("loading"),wp.media.ajax("envira_gallery_get_attachment_links",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.media_link),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertAttachmentPageLink:function(e){this.trigger("loading"),wp.media.ajax("envira_gallery_get_attachment_links",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.attachment_page),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})}}),EnviraGalleryChildViews=[];function EnviraGalleryImagesUpdate(e){EnviraGalleryImages.reset(),jQuery("ul#envira-gallery-output li.envira-gallery-image"+(e?".selected":"")).each(function(){var e=jQuery.parseJSON(jQuery(this).attr("data-envira-gallery-image-model"));e.alt=EnviraGalleryStripslashes(e.alt),EnviraGalleryImages.add(new EnviraGalleryImage(e))})}function EnviraGalleryStripslashes(e){return(e+"").replace(/\\(.?)/g,function(e,a){switch(a){case"\\":return"\\";case"0":return"\0";case"":return"";default:return a}})}jQuery(document).ready(function(e){e("a.envira-media-library").on("click",function(a){a.preventDefault(),wp.media.frames.envira?wp.media.frames.envira.open():(wp.media.frames.envira=wp.media({frame:"post",title:wp.media.view.l10n.insertIntoPost,library:{type:["image"]},button:{text:wp.media.view.l10n.insertIntoPost},multiple:!0}),wp.media.frames.envira.on("open",function(){var a=wp.media.frames.envira.state().get("selection");e("ul#envira-gallery-output li").each(function(){var t=wp.media.attachment(e(this).attr("id"));void 0!=a&&a.add(t?[t]:[])})}),wp.media.frames.envira.on("insert",function(a){var t=wp.media.frames.envira.state(),i=[];a.each(function(e){var a=t.display(e).toJSON();switch(a.link){case"none":case"file":e.set("link",e.get("url"));break;case"post":break;case"custom":e.set("link",a.linkUrl)}i.push(e.toJSON())},this),e(document).find(".envira-progress-adding-images").css("display","block"),e.post(envira_gallery_metabox.ajax,{action:"envira_gallery_insert_images",nonce:envira_gallery_metabox.insert_nonce,post_id:envira_gallery_metabox.id,order:e("#envira-config-image-sort").val(),direction:e("#envira-config-image-sort-dir").val(),images:JSON.stringify(i)},function(a){a&&a.success&&(e("#envira-gallery-output").html(a.success),e(document).trigger("enviraInsert"),EnviraGalleryImagesUpdate(!1),e(document).find(".envira-progress-adding-images").css("display","none"))},"json")}),wp.media.frames.envira.open(),e("div.media-menu #menu-item-gallery").css("display","none"),e("div.media-menu a.media-menu-item:nth-child(4)").addClass("hidden"),e("div.media-menu #menu-item-playlist").css("display","none"),e("div.media-menu #menu-item-video-playlist").css("display","none"),e("div.media-menu #menu-item-featured-image").css("display","none"))})});var envira_manage=window.envira_manage||{};!function(e,a,t,i,n){"use strict";var r="#envira-gallery-output",l=e(r+" li").length,s=!1,o=!1;a.envira_manage=i={init:function(){this.select(),this.select_all(),this.clear_selected(),this.sortable(),this.sort_images(),this.display_toggle(),this.delete_item(),this.bulk_delete(),this.edit_meta(),this.toggle_status(),this.tooltip(),e(t).on("keyup keydown",function(e){s=e.shiftKey}),this.image_filter(),e(t).trigger("envriaAdminInit")},image_filter:function(){e("#envira-filter-images").on("keyup",function(){var a=e(this).val(),t=e(".envira-gallery-image"),i="";""!=a?t.each(function(t){e(this).find(".title").text().search(a)>-1?e(this).show().fadeIn(1e3):(e(this).hide().fadeOut(1e3),e(this).removeClass("selected"),i=e(r+" li.selected").length,o=!1,0!==i?(e(".select-all").text(n.selected),e(".envira-count").text(i.toString()),e(".envira-clear-selected").fadeIn()):(l=e(r+" li").length,e(".select-all").text(n.select_all),e(".envira-count").text(l.toString()),e(".envira-clear-selected").fadeOut()))}):t.show()})},toggle_status:function(){e(r).on("click.enviraStatus",".envira-item-status",function(a){a.preventDefault(),a.stopPropagation();var i=e(this),r=i.data("status"),l=i.hasClass("list-status")?i.parent().parent().parent():i.parent(),s=l.find(".envira-item-status.list-status"),o=l.find(".envira-item-status.grid-status"),d=i.data("id"),c=o.find("span.dashicons"),v=s.find("span"),u="active"===r?"pending":"active",m={url:n.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_change_image_status",post_id:n.id,gallery_id:d,status:u,nonce:n.save_nonce},success:function(a){a.success&&("active"===u?(o.removeClass("envira-draft-item").addClass("envira-active-item"),s.removeClass("envira-draft-item").addClass("envira-active-item"),c.removeClass("dashicons-hidden").addClass("dashicons-visibility"),v.text(n.active),o.attr("data-envira-tooltip",n.active),s.data("status","active"),o.data("status","active")):(o.removeClass("envira-active-item").addClass("envira-draft-item"),s.removeClass("envira-active-item").addClass("envira-draft-item"),c.removeClass("dashicons-visibility").addClass("dashicons-hidden"),v.text(n.draft),s.data("status","pending"),o.data("status","pending"),o.attr("data-envira-tooltip",n.draft)),e(t).trigger("envriaChangeStatus "))},error:function(e,a,t){}};e.ajax(m)})},tooltip:function(){e("[data-envira-tooltip]").on("mouseover",function(a){a.preventDefault();e(this).data("envira-tooltip")})},select_all:function(){e(t).on("change","nav.envira-tab-options input",function(a){if(e(this).prop("checked")){e("li",e(r)).addClass("selected"),e("nav.envira-select-options").fadeIn();var i=e(r+" li.selected").length;e(".select-all").text(n.selected),e(".envira-count").text(i.toString()),e(".envira-clear-selected").fadeIn()}else e("li",e(r)).removeClass("selected"),e("nav.envira-select-options").fadeOut(),l=e(r+" li").length,e(".select-all").text(n.select_all),e(".envira-count").text(l.toString()),e(".envira-clear-selected").fadeOut();e(t).trigger("enviraSelectAll")})},sort_images:function(){e(t).on("change","#envira-config-image-sort, #envira-config-image-sort-dir",function(){e(this);var a=e("#envira-config-image-sort").val(),t=e("#envira-config-image-sort-dir").val(),l={url:n.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_sort_publish",post_id:n.id,order:a,direction:t,nonce:n.save_nonce},success:function(t){t&&(e(r).html(t.data),EnviraGalleryImagesUpdate(!1),"manual"===a||"0"==a?e(r).attr("data-sortable","1"):e(r).attr("data-sortable","0"),i.sortable())},error:function(e,a,t){}};e.ajax(l)})},sortable:function(){"1"===e(r).attr("data-sortable")?(e(r).hasClass("ui-sortable")&&e(r).sortable("enable"),e(r).sortable({containment:r,items:"li",cursor:"move",forcePlaceholderSize:!0,placeholder:"dropzone",helper:function(a,t){t.hasClass("selected")||t.addClass("selected").siblings().removeClass("selected");var i=t.parent().children(".selected").clone();return t.data("multidrag",i).siblings(".selected").remove(),e("<li/>").append(i)},stop:function(a,t){var i=t.item.data("multidrag");t.item.after(i).remove(),e.ajax({url:n.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_gallery_sort_images",order:e(r).sortable("toArray").toString(),post_id:n.id,nonce:n.sort},success:function(e){EnviraGalleryImagesUpdate(!1)},error:function(a,t,i){e(r).before('<div class="error"><p>'+t.responseText+"</p></div>")}})}})):e(r).hasClass("ui-sortable")&&e(r).sortable("disable")},select:function(){e(t).on("click","ul#envira-gallery-output li.envira-gallery-image > img, li.envira-gallery-image > div, li.envira-gallery-image > a.check",function(a){a.preventDefault();var t=e(this).parent(),i="";if(t.hasClass("selected"))t.removeClass("selected"),i=e(r+" li.selected").length,o=!1,0!==i?(e(".select-all").text(n.selected),e(".envira-count").text(i.toString()),e(".envira-clear-selected").fadeIn()):(l=e(r+" li").length,e(".select-all").text(n.select_all),e(".envira-count").text(l.toString()),e(".envira-clear-selected").fadeOut());else{if(s&&!1!==o){var d=e("ul#envira-gallery-output li").index(e(o)),c=e("ul#envira-gallery-output li").index(e(t)),v=0;if(d<c)for(v=d;v<=c;v++)e("ul#envira-gallery-output li:eq( "+v+")").addClass("selected");else for(v=c;v<=d;v++)e("ul#envira-gallery-output li:eq( "+v+")").addClass("selected")}e(t).addClass("selected"),o=e(t),i=e(r+" li.selected").length,e(".envira-clear-selected").fadeIn(),e(".select-all").text(n.selected),e(".envira-count").text(i.toString())}e("ul#envira-gallery-output > li.selected").length>0?e("nav.envira-select-options").fadeIn():e("nav.envira-select-options").fadeOut()})},clear_selected:function(){e(".envira-clear-selected").on("click",function(a){a.preventDefault(),e(r+" li.selected").removeClass("selected"),l=e(r+" li").length,e(".select-all").text(n.select_all),e(".envira-count").text(l.toString()),e(".envira-select-all").prop("checked",!1),e("nav.envira-select-options").fadeOut(),e(this).fadeOut(),e(t).trigger("enviraClearSelected")})},display_toggle:function(){e(t).on("click","nav.envira-tab-options a",function(a){a.preventDefault();var i=e(this).closest(".envira-tab-options"),r=e(this).data("view"),l=e(this).data("view-style");e(r).hasClass(l)||(e(r).removeClass("list").removeClass("grid").addClass(l),e("a",i).removeClass("selected"),e(this).addClass("selected"),e.ajax({url:n.ajax,type:"post",dataType:"json",data:{action:"envira_gallery_set_user_setting",name:"envira_gallery_image_view",value:l,nonce:n.set_user_setting_nonce},success:function(a){e(t).trigger("enviraDisplayToggle")},error:function(a,t,i){e(envira_gallery_output).before('<div class="error"><p>'+t.responseText+"</p></div>")}}))})},chosen:function(){e(".envira-chosen").each(function(){alert("b");var a=e(this).data("envira-chosen-options");e(this).chosen(a)})},update_count:function(){l=e(r+" li").length,e(".envira-count").text(l.toString()),l>0&&(e("#envira-empty-itemr").fadeOut().addClass("envira-hidden"),e(".envira-item-header").removeClass("envira-hidden").fadeIn(),e(".envira-bulk-actions").fadeOut())},delete_item:function(){e(t).on("click","#envira-gallery-main .envira-gallery-remove-image",function(a){if(a.preventDefault(),confirm(n.remove)){var t=e(this).parent().attr("id");e.ajax({url:n.ajax,type:"post",dataType:"json",data:{action:"envira_gallery_remove_image",attachment_id:t,post_id:n.id,nonce:n.remove_nonce},success:function(a){e("#"+t).fadeOut("normal",function(){e(this).remove(),e(".envira-gallery-load-library").attr("data-envira-gallery-offset",0).addClass("has-search").trigger("click"),EnviraGalleryImagesUpdate(!1),i.start_screen()})},error:function(a,t,i){e(envira_gallery_output).before('<div class="error"><p>'+t.responseText+"</p></div>")}})}})},bulk_delete:function(){e(t).on("click","a.envira-gallery-images-delete",function(a){if(a.preventDefault(),!confirm(n.remove_multiple))return!1;var t=[];e("ul#envira-gallery-output > li.selected").each(function(){t.push(e(this).attr("id"))});e(this).parent().attr("id");e.ajax({url:n.ajax,type:"post",dataType:"json",data:{action:"envira_gallery_remove_images",attachment_ids:t,post_id:n.id,nonce:n.remove_nonce},success:function(a){a&&(e(r+" > li.selected").remove(),e("nav.envira-select-options").fadeOut(),e(".envira-gallery-load-library").attr("data-envira-gallery-offset",0).addClass("has-search").trigger("click"),EnviraGalleryImagesUpdate(!1),i.update_count(),i.start_screen(),e(".envira-select-all").prop("checked",!1))},error:function(a,t,i){e(envira_gallery_output).before('<div class="error"><p>'+t.responseText+"</p></div>")}})})},edit_meta:function(){e(t).on("click","#envira-gallery-main a.envira-gallery-modify-image",function(a){a.preventDefault(),EnviraGalleryImagesUpdate(!1);var i=e(this).parent().data("envira-gallery-image");EnviraGalleryModalWindow.content(new EnviraGalleryEditView({collection:EnviraGalleryImages,child_views:EnviraGalleryChildViews,attachment_id:i})),EnviraGalleryModalWindow.open(),e(t).trigger("enviraEditOpen")})},start_screen:function(){0===(l=e(r+" li").length)?(e("nav.envira-select-options").fadeOut(),e(".envira-content-images").fadeOut().addClass("envira-hidden"),e("#envira-empty-gallery").removeClass("envira-hidden").fadeIn()):(e("#envira-empty-gallery").fadeOut().addClass("envira-hidden"),e(".envira-content-images").removeClass("envira-hidden").fadeIn())},update_selection:function(){}},e(function(){i.init()}),e(t).on("enviraGalleryType",function(){i.init()}),e(t).on("enviraInsert",function(){i.start_screen(),i.update_count()})}(jQuery,window,document,envira_manage,envira_gallery_metabox),jQuery(document).ready(function(e){e("#envira-gallery-main").on("click","a.envira-gallery-images-move",function(a){a.preventDefault();var t=e(this).data("action");EnviraGalleryModalWindow.content(new EnviraGallerySelectionView({action:t,multiple:!1,sidebar_view:"envira-meta-move-media-sidebar",modal_title:envira_gallery_metabox.move_media_modal_title,insert_button_label:envira_gallery_metabox.move_media_insert_button_label,onInsert:function(){EnviraGalleryImagesUpdate(!0);var a=[];EnviraGalleryImages.forEach(function(e){a.push(e.get("id"))}),this.selection.forEach(function(i){wp.media.ajax("envira_"+t+"_move_media",{context:this,data:{nonce:envira_gallery_metabox.move_media_nonce,from_gallery_id:envira_gallery_metabox.id,to_gallery_id:i.id,image_ids:a},success:function(a){e("ul#envira-gallery-output > li.selected").remove(),e("nav.envira-select-options").fadeOut(),EnviraGalleryImagesUpdate(!1),EnviraGalleryModalWindow.close()},error:function(e){alert(e)}})})}})),EnviraGalleryModalWindow.open()})}),function(e){e(function(){if("undefined"!=typeof uploader){e("input#plupload-browse-button").val(envira_gallery_metabox.uploader_files_computer);var a=e("#envira-gallery .envira-progress-bar"),t=e("#envira-gallery .envira-progress-bar div.envira-progress-bar-inner"),i=e("#envira-gallery .envira-progress-bar div.envira-progress-bar-status"),n=e("#envira-gallery-output"),r=e("#envira-gallery-upload-error"),l=0;uploader.bind("Init",function(a){e("#drag-drop-area").fadeIn(),e("a.envira-media-library.button").fadeIn()}),uploader.bind("FilesAdded",function(t,n){e(r).html(""),l=n.length,e(".uploading .current",e(i)).text("1"),e(".uploading .total",e(i)).text(l),e(".uploading",e(i)).show(),e(".done",e(i)).hide(),n[0].name.includes(".zip")&&e(".uploading").hide(),e(a).fadeIn("fast",function(){e("p.max-upload-size").css("padding-top","10px")})}),uploader.bind("UploadProgress",function(a,n){n.name.includes(".zip")?(e(".uploading").hide(),e(".opening_zip",e(i)).show()):e(".uploading .current",e(i)).text(l-a.total.queued+1),e(t).css({width:a.total.percent+"%"})}),uploader.bind("FileUploaded",function(t,r,s){r.name.includes(".zip")?(e(".uploading").hide(),e(".done").hide(),e(".uploading_zip").hide(),e(".envira_bar").show(),e(".envira_status").show(),e(".opening_zip").show()):e(".uploading .current",e(i)).text(l-t.total.queued+1),e.post(envira_gallery_metabox.ajax,{action:"envira_gallery_load_image",nonce:envira_gallery_metabox.load_image,id:s.response,post_id:envira_gallery_metabox.id},function(t){switch(envira_gallery_metabox.media_position){case"before":e(n).prepend(t);break;case"after":default:e(n).append(t)}e(document).trigger("enviraInsert"),EnviraGalleryImagesUpdate(!1),r.name.includes(".zip")&&(e(".opening_zip").hide(),e(".uploading_zip").hide(),e(".done_zip",e(i)).show(),setTimeout(function(){e(a).fadeOut(),e(".done_zip",e(i)).hide(),e("p.max-upload-size").css("padding-top","0")},8e3))},"json")}),uploader.bind("UploadComplete",function(t,n){if(n[n.length-1].name.includes(".zip"))return e(".done").hide(),void e(".uploading_zip",e(i)).hide();e(".uploading",e(i)).hide(),e(".done",e(i)).show(),setTimeout(function(){e(a).fadeOut("fast",function(){e("p.max-upload-size").css("padding-top","0")})},1e3)}),uploader.bind("Error",function(a,t){e("#envira-gallery-upload-error").html('<div class="error fade"><p>'+t.file.name+": "+t.message+"</p></div>"),a.refresh()})}})}(jQuery);